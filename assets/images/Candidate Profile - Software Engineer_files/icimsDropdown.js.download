var ICIMS=window.ICIMS||window.icimsUtils||{};var DEFAULT_LOCALE="en_US";ICIMS.dropdowns={};ICIMS.dropdown=ICIMS.dropdown||function(a){return icimsSearchDropdown(a)};function icimsSearchDropdown(D){var B=D.list,a5=D.placeholder||resourceBundle.get("icimsdropdown.js.MakeASelection_1"),T=typeof D.placeholderAsOption==="boolean"?D.placeholderAsOption:true,H=D.textSearch||resourceBundle.get("icimsdropdown.js.TypeToSearch_2"),a7=D.textNoResults||resourceBundle.get("icimsdropdown.js.NoResults_3"),q=D.matcher||aW,S=D.value||"value",aM=D.text||"text",ak=D.parent||"parent",a0=D.onchange||function(){},aA=D.onchangefinished||function(){},A=typeof D.search==="boolean"?D.search:true,aQ=typeof D.prefetch==="boolean"?D.prefetch:typeof D.loadOnStart==="boolean"?D.loadOnStart:true,X=typeof D.bootstrap==="boolean"?D.bootstrap:false,ap=D.formatOption||function(){return""},ay=D.formatGroupOption||function(){return""},J=D.filter||function(){return true},aR=D.ajax,ab,p=[],au=[],g=[],aa={},i=typeof D.enabled==="boolean"?D.enabled:true,Y=false,aj=false,e=false,ao,ax,aH="",P=typeof D.expensive==="boolean"?D.expensive:false,L=D.limit||25,av=0,aL=-1,G=-1,r=0,a2=0,O=0,ah={},aF={},aO={},F=ICIMS.isMobile(),aJ=ICIMS.isTouch(),U=D.locale||DEFAULT_LOCALE;var d=B.getAttribute("data-ddd-parent-link");var z=a1(B),u=Q(z),aD=v(z),aY=R(aD),M=y(aY),aw=aZ(M),af=aq(z);var ae=typeof ICIMS.trickle==="function"?ICIMS.trickle({element:aw,ticker:200}):{start:function(){},finish:function(){}};var a6=function(){return{open:Y,enabled:i}};var h=function(){ICIMS.removeClass(B,"dropdown-hide");af.parentNode.removeChild(af);aw.parentNode.removeChild(aw);M.parentNode.removeChild(M);aD.parentNode.removeChild(aD);u.parentNode.removeChild(u);z.parentNode.removeChild(z);delete ICIMS.dropdowns[B.id]};var ba=function(){if(z&&!aJ){z.focus()}};var a9={params:D,toggleList:I,collapseList:aV,expandList:K,getWords:C,setWords:aS,addWords:n,findWordFromValue:j,setFilter:at,getMatches:aT,resetOptions:aB,loadOptions:aI,initializeList:a4,initializeSelected:aP,repositionContainer:a8,updateSelected:o,optionSelected:az,getSelected:a,getPreviousSelected:aN,getDefaultSelected:m,getInput:t,setInput:aK,getAjax:am,setAjax:V,setPlaceholder:ad,state:a6,enable:W,disable:E,destroy:h,focus:ba};ICIMS.dropdowns[B.id]=a9;f();a4();aP();if(!d&&(aQ||!A)){aB()}if(!i){ICIMS.addClass(z,"disabled")}ICIMS.addClass(B,"dropdown-hide");function a4(){if(!aR){aS(Z(B));G=Math.ceil(C().length/L)}else{au=Z(B,true)}O=B.options.length}function aP(){if(aR&&aR.selected){aU(aR)}else{s()}}function aU(bc){k("Loading...",true);aC(bc.selected,ac)}function s(){var bc=ICIMS.getSelected(B).length?ICIMS.getSelected(B)[0]:null;if(bc){var bd=j(bc[S]);if(bd){aO=bd}else{aO[S]=bc[S];aO[aM]=ICIMS.getText(bc)}o(aO)}}function f(){var be=aJ?"touchstart":"mousedown";ICIMS.addEvent(M,"click",function(bp){var bo=ICIMS.getTarget(bp);if(!ICIMS.hasClass(bo,"result-selectable")){bo=ICIMS.getParent(bo,"result-selectable")}if(bo){var bm=Number(bo.getAttribute("dropdown-index")),bn=ag(bm);az(bn);if(!aJ){z.focus()}bf(bo)}ICIMS.stopEvent(bp)});ICIMS.addEvent(document,be,function(bn){var bm=ICIMS.getTarget(bn);if(i&&(bm===z||ICIMS.getParent(bm,"dropdown-select")===z)){if(!e){if(!P){aB()}else{w()}}I();if(!aJ){z.focus()}if(A&&!aJ&&Y){aY.focus()}ICIMS.stopEvent(bn)}else{if(Y&&bm!==aD&&ICIMS.getParent(bm,"dropdown-container")!==aD){aV()}}});ICIMS.addEvents(aY,{keyup:function(bn){if(t()!==aH){aH=t();if(aR){if(ab){ab.abort()}if(ao){clearTimeout(ao)}if(!P||(P&&aH.length>=2)){var bm=500;if(P&&aH.length<6){bm+=250*(6-aH.length)}ao=setTimeout(function(){aB()},bm)}else{w()}}else{aB()}}},keydown:function(bm){if(bm.keyCode===9){if(Y){aV();if(!aJ){z.focus()}bk(r)}}},click:function(bm){ICIMS.stopEvent(bm)}});ICIMS.addEvent(aD,"keyup",bg);ICIMS.addEvent(aD,"keydown",function(bm){if(Y){bc(bm)}});ICIMS.addEvent(z,"keyup",bg);ICIMS.addEvent(z,"keydown",function(bn){if(!e){if(!P){aB()}else{w()}}if((A&&bn.keyCode===32)||bn.keyCode===13){if(Y){bk(r)}else{K();if(A&&!aJ){aY.focus()}}ICIMS.stopEvent(bn)}else{if(bn.keyCode>=48&&bn.keyCode<=90){if(A){K();aY.focus();aY.value=""}else{if(ax){clearTimeout(ax)}var bo=String.fromCharCode(bn.keyCode);z.tempInput+=bo;var bm=aT(z.tempInput,function(bp,bq){if(bq.match(new RegExp("^"+bp+".*$","i"))!==null){return true}})[0];if(bm){o(bm);ICIMS.removeEvent(z,"blur");ICIMS.addEvent(z,"blur",function(bp){az(bm)})}ax=setTimeout(function(){z.tempInput=""},750)}}else{if(bn.keyCode===9){if(Y){aV();if(!aJ){z.focus()}bk(r)}}else{ICIMS.removeEvent(z,"blur");K();bc(bn)}}}});ICIMS.addEvent(window,"resize",function(){a8()});if(aJ){ICIMS.addEvent(M,"touchmove",function(){bd()})}else{ICIMS.addEvents(M,{scroll:function(bm){bd()},mouseenter:function(bm){bi(bl(r))},mousewheel:function(bm){bh(bm)},DOMMouseScroll:function(bm){bh(bm)}})}function bg(bm){if(ICIMS.hasClass(document.body,"mode-popup")){if((bm.keyCode!==undefined&&bm.keyCode===27)||(bm.key!==undefined&&bm.key===27)){bm.stopPropagation()}}}function bc(bp){if(bp.keyCode===27){bi(bl(r));r=t()?-1:-(au.length+1);aV();ba()}else{if(r>=-(au.length+1)){if(bp.keyCode===13){bk(r);setTimeout(function(){if(!aJ){z.focus()}},50);ICIMS.stopEvent(bp)}else{if(bp.keyCode===40&&!bp.altKey){var bo=r+1,bm=ag(bo),bn=bl(bo);while(bm&&(bn==null||!ICIMS.hasClass(bn,"result-selectable"))){bo++;bm=ag(bo);bn=bl(bo)}bf(bn);ICIMS.stopEvent(bp)}else{if(bp.keyCode===38&&!bp.altKey){var bo=r-1,bm=ag(bo),bn=bl(bo);while(bm&&(bn==null||!ICIMS.hasClass(bn,"result-selectable"))){bo--;bm=ag(bo);bn=bl(bo)}bf(bn);if(bo===-1){aY.scrollIntoView({block:"nearest"})}ICIMS.stopEvent(bp)}}}}}}function bk(bm){var bn=ag(bm);if(bn){bf(bl(bm));az(bn)}}function bd(){if(bj(M.offsetHeight,M.scrollHeight*0.25,M.scrollHeight)){aI()}}function bh(bn){var bo=(bn.type==="DOMMouseScroll"?bn.detail*-40:bn.wheelDelta),bm=bo>0;if(!bm&&-bo>M.scrollHeight-M.offsetHeight-M.scrollTop){M.scrollTop=M.scrollHeight;ICIMS.stopEvent(bn)}else{if(bm&&bo>M.scrollTop){M.scrollTop=0;ICIMS.stopEvent(bn)}}}function bj(bo,bn,bm){if(bo+M.scrollTop+bn>=bm){return true}else{return false}}function bf(bm){if(bm){bi(bl(r));r=Number(bm.getAttribute("dropdown-index"));ICIMS.addClass(bm,"result-focus");bm.scrollIntoView({block:"nearest"});M.scrollTop=bm.offsetTop;if(A){aY.setAttribute("aria-activedescendant",bm.getAttribute("id"))}else{z.setAttribute("aria-activedescendant",bm.getAttribute("id"))}}}function bi(bm){if(bm){ICIMS.removeClass(bm,"result-focus")}}function bl(bm){for(var bn=0;bn<M.childNodes.length;bn++){var bo=M.childNodes[bn].getAttribute("dropdown-index");if(bo&&Number(bo)===bm){return M.childNodes[bn]}}return null}}function az(bc){var bd=!window.pageDirtyFlag&&bc&&bc.value==="-999";aF=ah;o(bc);aV();a0(B,bc);if(O!==B.options.length){O=B.options.length;s();aB()}ICIMS.removeEvent(z,"blur");if(bd){window.pageDirtyFlag=false}aA()}function I(){if(Y){aV()}else{K()}}function K(){ICIMS.addClass(z,"focus");ICIMS.removeClass(aD,"dropdown-invisible");aD.setAttribute("aria-expanded","true");z.setAttribute("aria-expanded","true");Y=true;a8();if(!aJ){aY.select()}}function aV(){ICIMS.removeClass(z,"focus");ICIMS.addClass(aD,"dropdown-invisible");aD.setAttribute("aria-expanded","false");z.setAttribute("aria-expanded","false");if(A){aY.blur();aY.removeAttribute("aria-activedescendant")}else{z.removeAttribute("aria-activedescendant")}Y=false;a8()}function c(bc){if(typeof bc==="object"&&bc!==null){switch(U){case"en_US":default:return bc.en_US}}else{return bc}}function o(bc){ah=bc;var be=bc[S];var bj=c(bc[aM]);var bk=ICIMS.escapeHtml(bj);var bd=ap(bc);k(bd+bk,be=="-999");if(aR){var bh=document.createElement("option"),bf=bc.attr;if(be){bh.setAttribute("value",be);bh.setAttribute("selected","selected")}if(bj){ICIMS.setInnerHtml(bh,bk)}B.options.length=0;B.appendChild(bh);B.selectedIndex=0;O=1;for(var bl in bf){if(bf.hasOwnProperty(bl)){try{B.options[0].setAttribute(bl,bf[bl])}catch(bi){B.options[0][bl]=bf[bl]}}}}else{for(var bg=0;bg<B.options.length;bg++){if(B.options[bg].value===be){B.selectedIndex=bg}}}}function k(bi,bg){var bf=bi||N(a5);var be=bi||a5;if(bg&&B.getAttribute("data-ddd-parent-link")){bf=N(bi);be=bi}var bh=B.getAttribute("aria-labelledby");if(!bh){var bd=B.getAttribute("aria-label");var bc=document.getElementById("label_"+B.getAttribute("id"))||document.querySelector('label[for="'+z.id+'"]');if(bd){z.setAttribute("aria-label",bd+" "+be)}else{if(bc){z.setAttribute("aria-label",bc.textContent+" "+be)}else{z.setAttribute("aria-label",be)}}}ICIMS.setInnerHtml(u,bf)}function a(){return ah}function aN(){return aF}function m(){return aO}function aT(bd,bf){bf=typeof bf==="function"?bf:q;var bc=[];for(var be=0;be<g.length;be++){if(bf(bd,g[be][aM])){bc.push(g[be])}else{if(bf(bd,g[be][S])){bc.push(g[be])}}}return bc}function aB(bc){e=true;aj=true;aa={};aL=-1;av=0;G=1;a2=0;r=t()?-1:-(au.length+1);if(ab){ab.abort()}w();aI(bc)}function aI(bc){if(av<G&&av>aL){ae.start(true);aL=av;if(aR){ab=aC(aR,function(bd){a3(bd);typeof bc==="function"&&bc(bd)})}else{p=aT(t());G=Math.ceil(p.length/L);aE(av);av++;a8()}}}function ac(bd){var bc=ICIMS.jsonDecode(bd.response||bd.responseText);if(bc[S]){aO=aF=bc;if(aR.selected.onchange){az(bc)}else{o(bc)}}else{if(!B.getAttribute("data-ddd-parent-link")){k()}}if(aR.selected.after){aR.selected.after(B,bc)}if(d){aB()}}function a3(be){var bd=ICIMS.jsonDecode(be.response||be.responseText);if(aR.adapter){bd=aR.adapter(bd,aR.maskedAttrs)}var bf=bd.options;if(aj){aS(bf);G=Math.ceil((bd.total)/L);if(aR.ini){aR.ini(bf)}}else{n(bf)}p=g;var bc=aE(av);av++;a8();aj=false;if(aR.loadAll||bc.length===0){aI()}}function aE(bi){var bf="";var bj=p.slice(bi*L,(bi+1)*L);var bc=bj.filter(J);var bg;for(bg=0;bg<bj.length;bg++){var bk=bj[bg];var bd=bc.filter(function(bl){return bl[S]===bk[S]});var bh=bd.length===0;if(bk[ak]&&!aa[bk[ak]]){bf+=ai(bk,bg+(bi*L));aa[bk[ak]]=true}if(!(bk[ak]&&!bk[aM])){bf+=l(bk,bg+(bi*L),bh)}}if(bi===0&&bf===""){var be=ai({parent:a7},0);M.innerHTML+=be}else{M.innerHTML+=bf}ae.finish();if(aj&&!Y&&B.getAttribute("data-ddd-parent-link")&&typeof updateDropdownPlaceholder==="function"&&(typeof ah[S]==="undefined"||!ah[S]||ah[S]==="-999")){updateDropdownPlaceholder(B,g.length)}return bc}function w(){var bd="";var bc;for(bc=0;bc<au.length;bc++){if(au[bc][S]===""&&T===false){continue}bd+=l(au[bc],-(au.length-bc))}M.innerHTML=bd;a8()}function N(bc){return'<span class="dropdown-placeholder">'+bc+"</span>"}function ai(be,bd){var bc=c(be[ak]);var bf='<li class="dropdown-result result-group result-selectable" role="option"';bf+=' dropdown-index="';bf+=bd;bf+='" ';bf+=' id="result-group_';bf+=B.id;bf+="_";bf+=bd;bf+='" aria-label="';bf+=bc;bf+='">';bf+=ay(be);bf+=bc;bf+="</li>";return bf}function l(bf,bc,bg){var bh=c(bf[aM]);var be=ICIMS.escapeHtml(bh),bd="";bd+='<li class="dropdown-result ';bd+=bg?"dropdown-invisible":"result-selectable";bd+='" role="option"';bd+=' id="result-selectable_';bd+=B.id;bd+="_";bd+=bc;bd+='" dropdown-index="';bd+=bc;bd+='" title="';bd+=be?be:a5;bd+='" aria-label="';bd+=be?be:a5;bd+='">';bd+=ap(bf,bc);bd+=be?(bc>=0?aG(be,ICIMS.escapeHtml(t())):be):N(a5);bd+="</li>";return bd}function aG(bc,bd){if(bd){bd=bd.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");return bc.replace(new RegExp("("+bd+")","gi"),function(be,bf){return"<b>"+bf+"</b>"})}else{return bc}}function aW(bc,bd){return bd.toString().toUpperCase().indexOf(bc.toString().toUpperCase())>=0}function aC(bg,bj){var bk,bd="",bh=t(),bi=bg.url.lastIndexOf("?")===-1?"?":"&";var bc=bg.data(bh,av,bg,D);bk=b(bc);bd=bg.url+bi+bk;var be=bg.postData?bg.postData:null;var bf=ICIMS.ajax(bd,{data:be,callback:bj,dataType:"application/json, text/javascript"});return bf}function b(bd){var be=[];for(var bc in bd){if(bd.hasOwnProperty(bc)){be.push(encodeURIComponent(bc)+"="+encodeURIComponent(bd[bc]))}}return be.join("&")}function Z(bj,bc){var be=[];for(var bg=0;bg<bj.options.length;bg++){var bh=bj.options[bg],bd=ICIMS.getElementAttributes(bh),bi={attr:{}};bi[aM]=bh[aM]||bh.innerHTML;bi[S]=bh[S]||"";if(bh.parentNode.tagName==="OPTGROUP"){bi[ak]=bh.parentNode.label;bi.parentNode=bh.parentNode}for(var bf in bd){if(bd.hasOwnProperty(bf)&&bf!==S&&bf!==aM){bi.attr[bf]=bd[bf]}}if(!bc||(bc&&bi.attr.legacy)){be.push(bi)}}return be}function an(){return au}function j(be){var bc=C(true);for(var bd=0;bd<bc.length;bd++){if(bc[bd][S]===be||bc[bd][aM]===be||(typeof bc[bd].attr!=="undefined"&&bc[bd].attr.dataid===be)){return bc[bd]}}return null}function ag(bc){if(bc<0){bc=au.length+bc;return au[bc]}else{return p[bc]}}function C(bc){if(bc){return au.concat(g)}else{return g}}function aS(bc){g=bc;return this}function n(bc){g=g.concat(bc);return this}function at(bc){J=bc;return this}function t(){return aY.value.trim()}function aK(bc){aY.value=bc}function W(){i=true;ICIMS.removeClass(z,"disabled")}function E(){i=false;ICIMS.addClass(z,"disabled")}function am(){return aR}function V(bc){aR=bc;return this}function ad(bc){a5=bc;return this}function bb(){ar(aD,z.offsetWidth);ar(aY,z.clientWidth-40)}function a8(){ICIMS.removeClass(aD,"bottom");ICIMS.removeAttribute(aD.style,"top");bb();var be=12;M.style.maxHeight=(be*2)+"em";var bf=ICIMS.getWindowSize(),bc=aD.getBoundingClientRect();if(bg(bf.y)){while(be>2){be--;M.style.maxHeight=(be*2)+"em";bc=aD.getBoundingClientRect();if(bf.y>=bc.bottom){break}if(aD.offsetTop-aD.offsetHeight-z.clientHeight>0){break}}}if(bd(bf.y)){ICIMS.addClass(aD,"bottom");aD.style.top=aD.offsetTop-aD.offsetHeight-z.clientHeight+"px"}function bg(bh){return bh<aD.offsetHeight||(bh<bc.bottom&&bc.top*0.85<aD.offsetHeight)}function bd(bk){var bj=bk<bc.bottom;var bh=aD.offsetTop<aD.offsetHeight+z.clientHeight;var bi=z.getBoundingClientRect().top<aD.offsetHeight+z.clientHeight;return bj&&!bh&&!bi}}function a1(bh){var bg=document.createElement("a");bg.id=bh.id+"_icimsDropdown";bg.className="dropdown-select"+(X?" form-control":"");bg.setAttribute("aria-expanded","false");bg.setAttribute("tabIndex","0");var bf=bh.getAttribute("aria-labelledby");var bd=bh.getAttribute("aria-label");var bc=document.getElementById("label_"+bh.getAttribute("id"))||document.querySelector('label[for="'+bg.id+'"]');if(bf){bg.setAttribute("aria-labelledby",bf);bh.removeAttribute("aria-labelledby")}else{if(bd){bg.setAttribute("aria-label",bd+" "+a5)}else{if(bc){bg.setAttribute("aria-label",bc.textContent+" "+a5)}else{bg.setAttribute("aria-label",a5)}}}var be=bh.getAttribute("aria-required");if(be){bg.setAttribute("aria-required",be);bh.removeAttribute("aria-required")}bg.setAttribute("role","combobox");aX(bh,bg);al(bh,bg);bg.tempInput="";x(bh,bg);return bg}function aX(bd,bc){if(bd.id.includes("PersonProfileFields.AddressCountry")){bc.setAttribute("autocomplete","country-name")}}function al(bd,bc){if(bd.id.includes("PersonProfileFields.AddressState")){bc.setAttribute("autocomplete","address-level1")}}function Q(bc){var bd=document.createElement("span");bd.id=B.id+"_fakeSelected_icimsDropdown";bd.className="dropdown-text";ICIMS.setInnerHtml(bd,a5);bc.appendChild(bd);return bd}function aq(bd){var be=document.createElement("div");var bc=document.createElement("i");be.className="dropdown-arrow-container";bc.className="dropdown-arrow";be.appendChild(bc);bd.appendChild(be);return bc}function v(bd){var bc=document.createElement("div");ar(bc,bd.offsetWidth);bc.id=bd.id+"_ctnr";bc.className="dropdown-container dropdown-invisible"+(X?" bootstrap":"");bc.setAttribute("aria-owns",B.id+"_dropdown-results");bc.setAttribute("aria-expanded","false");x(bd,bc);return bc}function R(bc){var be=document.createElement("input");be.type="text";be.className="dropdown-search";ar(be,z.clientWidth-40);be.setAttribute("autocomplete","off");be.setAttribute("placeholder",H);be.setAttribute("title",H);be.setAttribute("aria-label",H);bc.appendChild(be);bd(be);if(!A){be.className+=" dropdown-invisible";be.setAttribute("aria-hidden","true")}else{be.setAttribute("aria-autocomplete","list");be.setAttribute("aria-controls",B.id+"_dropdown-results")}return be;function bd(bh){var bf=document.createElement("input"),bg;if(!("placeholder" in bf)){bg=document.createElement("span");bg.setAttribute("tabindex","-1");bg.className="dropdown-placeholder fake";if(!A){bg.className+=" dropdown-invisible"}ICIMS.setInnerHtml(bg,H);bh.parentNode.insertBefore(bg,bh);ICIMS.addEvent(bg,"click",function(){bh.focus()});ICIMS.addEvent(bh,"keyup",function(){if(t().length||!A){ICIMS.addClass(bg,"dropdown-invisible")}else{ICIMS.removeClass(bg,"dropdown-invisible")}})}}}function y(be){var bd=document.createElement("div"),bc=document.createElement("ul");bc.id=B.id+"_dropdown-results";bc.className="dropdown-results";bc.setAttribute("role","listbox");bd.appendChild(bc);x(be,bd);return bc}function aZ(bc){var bd=document.createElement("div");bd.className="dropdown-loading hide";bd.style.width="0%";x(bc,bd);return bd}function x(bc,bd){bc.parentNode.insertBefore(bd,bc.nextSibling)}function ar(bc,bd){bc.style.width=Math.max(bd,0)+"px"}return a9}function closeAllDropdowns(){for(var b in ICIMS.dropdowns){if(ICIMS.dropdowns.hasOwnProperty(b)){var a=ICIMS.dropdowns[b];a.collapseList()}}}(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a(require("icims-utils")):typeof define==="function"&&define.amd?define(["icims-utils"],a):b.icimsDropdown=a(b.icimsUtils)}(this,(function(a){return icimsSearchDropdown})));